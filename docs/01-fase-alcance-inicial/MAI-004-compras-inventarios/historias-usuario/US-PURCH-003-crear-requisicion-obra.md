# US-PURCH-003: Crear RequisiciÃ³n desde Obra

**Ã‰pica:** MAI-004 - Compras e Inventarios
**Sprint:** 12
**Story Points:** 5
**Prioridad:** Alta

---

## Historia de Usuario

**Como** Residente de Obra
**Quiero** solicitar materiales que necesito para las actividades programadas
**Para** que el departamento de compras gestione la adquisiciÃ³n sin retrasar la construcciÃ³n

---

## Criterios de AceptaciÃ³n

### AC1: Crear Nueva RequisiciÃ³n
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NUEVA REQUISICIÃ“N DE MATERIALES                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CÃ³digo: REQ-2025-00123 (automÃ¡tico)                 â”‚
â”‚ Proyecto: Fracc. Los Pinos                          â”‚
â”‚ Solicitante: Ing. Pedro RamÃ­rez (Residente)         â”‚
â”‚ Fecha: 20/Nov/2025                                  â”‚
â”‚                                                      â”‚
â”‚ Fecha necesaria: [25/Nov/2025] *                    â”‚
â”‚ Urgencia: (â—) Normal  ( ) Urgente                   â”‚
â”‚                                                      â”‚
â”‚ Materiales Requeridos:        [+ Buscar material]   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Material     â”‚ Cant â”‚ Unidâ”‚ Presup.  â”‚Disponibleâ”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Cemento CPC  â”‚ 120  â”‚ ton â”‚ $516,000 â”‚âœ“ SÃ­      â”‚â”‚
â”‚ â”‚   Partida:02-CimentaciÃ³n                        â”‚â”‚
â”‚ â”‚   ğŸ“Š Presupuestado:250t | Ejercido:130t |Disp:120â”‚â”‚
â”‚ â”‚                                                  â”‚â”‚
â”‚ â”‚ Grava 3/4"   â”‚ 85   â”‚ mÂ³  â”‚ $32,300  â”‚âœ“ SÃ­      â”‚â”‚
â”‚ â”‚   Partida:02-CimentaciÃ³n                        â”‚â”‚
â”‚ â”‚   ğŸ“Š Presupuestado:200mÂ³|Ejercido:115mÂ³|Disp:85 â”‚â”‚
â”‚ â”‚                                                  â”‚â”‚
â”‚ â”‚ Arena        â”‚ 100  â”‚ mÂ³  â”‚ $29,500  â”‚âš ï¸ Excede â”‚â”‚
â”‚ â”‚   Partida:02-CimentaciÃ³n                        â”‚â”‚
â”‚ â”‚   ğŸ“Š Presupuestado:80mÂ³|Ejercido:0mÂ³|Disp:80    â”‚â”‚
â”‚ â”‚   âš ï¸ Solicitas 100 mÂ³ pero solo hay 80 disponib.â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚ JustificaciÃ³n: *                                     â”‚
â”‚ [CimentaciÃ³n etapa 2 segÃºn programa de obra.       ]â”‚
â”‚ [Inicio: 25/Nov/2025. Requiere materiales previo.  ]â”‚
â”‚                                                      â”‚
â”‚ Total estimado: $577,800                            â”‚
â”‚                                                      â”‚
â”‚    [Guardar Borrador]  [Enviar a AprobaciÃ³n]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Validaciones:
- Fecha necesaria >= hoy + 5 dÃ­as (lead time mÃ­nimo)
- Todos los materiales existen en presupuesto
- Si excede presupuesto disponible: Mostrar alerta
- JustificaciÃ³n obligatoria si urgente o excede presup
```

### AC2: Flujo de AprobaciÃ³n por Monto
```
REQ-2025-00123: $577,800
Aplicar matriz de aprobaciÃ³n:

Nivel 1: Gerente de Compras (monto >$50K)
  Status: Pendiente
  Notificado: gerente.compras@constructora.com

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REQUISICIÃ“N REQ-2025-00123                           â”‚
â”‚ Solicitante: Ing. Pedro RamÃ­rez                      â”‚
â”‚ Monto: $577,800                                      â”‚
â”‚ Urgencia: Normal                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Materiales:                                          â”‚
â”‚   â€¢ Cemento CPC 30R: 120 ton                        â”‚
â”‚   â€¢ Grava 3/4": 85 mÂ³                               â”‚
â”‚   â€¢ Arena: 100 mÂ³ âš ï¸ Excede presupuesto            â”‚
â”‚                                                      â”‚
â”‚ JustificaciÃ³n:                                       â”‚
â”‚ "CimentaciÃ³n etapa 2 segÃºn programa..."            â”‚
â”‚                                                      â”‚
â”‚ Comentarios: (opcional)                              â”‚
â”‚ [Arena excede por cambio en diseÃ±o de zapatas.      ]â”‚
â”‚ [Ya validado con Director de Proyectos.            ]â”‚
â”‚                                                      â”‚
â”‚         [âœ“ Aprobar]  [âœ— Rechazar]  [â†©ï¸ Devolver]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Al aprobar:
- Status: approved
- Se puede generar RFQ automÃ¡ticamente
- NotificaciÃ³n a solicitante
```

### AC3: Historial de Requisiciones
```
Vista del Residente:

MIS REQUISICIONES
Filtros: [Todas â–¼] [Este mes â–¼]  [ğŸ” Buscar...]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CÃ³digo         â”‚ Fecha  â”‚ Monto     â”‚ Status       â”‚â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ REQ-2025-00123 â”‚20/Nov  â”‚ $577,800  â”‚ğŸŸ¡ Pendiente  â”‚â”‚
â”‚   3 materiales â”‚        â”‚           â”‚ Nivel 1/1    â”‚â”‚
â”‚                                                      â”‚
â”‚ REQ-2025-00118 â”‚15/Nov  â”‚ $245,000  â”‚âœ… Aprobada   â”‚â”‚
â”‚   2 materiales â”‚        â”‚           â”‚ OC generada  â”‚â”‚
â”‚                                                      â”‚
â”‚ REQ-2025-00112 â”‚10/Nov  â”‚ $680,000  â”‚âœ… Aprobada   â”‚â”‚
â”‚   5 materiales â”‚        â”‚           â”‚ Cotizando    â”‚â”‚
â”‚                                                      â”‚
â”‚ REQ-2025-00105 â”‚05/Nov  â”‚ $125,000  â”‚ğŸ“¦ Recibida   â”‚â”‚
â”‚   3 materiales â”‚        â”‚           â”‚ En almacÃ©n   â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Al hacer clic en REQ-2025-00123:
  Ver detalle completo
  Timeline de aprobaciones
  RFQs/OCs generadas
  Recibos de almacÃ©n
```

### AC4: Alertas y Notificaciones
```
Notificaciones del residente:

ğŸ”” RequisiciÃ³n REQ-2025-00123 aprobada
   Gerente de Compras aprobÃ³ tu solicitud
   PrÃ³ximo paso: CotizaciÃ³n con proveedores
   Hace 2 horas

ğŸ”” Material recibido en almacÃ©n
   REQ-2025-00105: Cemento CPC 30R (80 ton)
   AlmacÃ©n: Fracc. Los Pinos
   Ayer

âš ï¸ RequisiciÃ³n REQ-2025-00098 rechazada
   Motivo: "Material fuera de presupuesto sin autorizaciÃ³n"
   Por: Director de Proyectos
   Hace 3 dÃ­as
```

---

## Notas TÃ©cnicas

### Backend
- Endpoint: `POST /api/requisitions`
- Validar disponibilidad presupuestal en tiempo real
- Determinar flujo de aprobaciÃ³n segÃºn monto
- Notificaciones por email + in-app

### Frontend
- Autocompletado de materiales desde presupuesto
- Indicador visual de disponibilidad presupuestal
- Timeline de aprobaciones con Stepper component
- Notificaciones en tiempo real (WebSocket)

---

## DefiniciÃ³n de Hecho (DoD)

- [ ] Crear requisiciÃ³n con materiales del presupuesto
- [ ] ValidaciÃ³n de disponibilidad presupuestal
- [ ] Flujo de aprobaciÃ³n por niveles
- [ ] Notificaciones a aprobadores
- [ ] Historial de requisiciones del usuario
- [ ] Comentarios en aprobaciones/rechazos
- [ ] Tests de validaciones

---

**Referencias:** RF-PURCH-002, ET-PURCH-002
